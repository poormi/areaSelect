!function($,w){"use strict";function _init(e,t){function a(e,t,n){var d=$("<span>"),s=$("<li>"),l=['<a href="javascript:"><span>',n.name,'</span><i class="triangle"> </i>',"</a>"];d.html(n.name),d.data("code",n.code),e.P(d),t.length&&(s.data("code",n.code),s.data("index",t.C().length),t.P(s.P(l.join("")))),n.data&&n.data.length&&(e.P(i.split),a(e,t,n.data[0]))}function n(e,t){var a=$.create("ul");a.data("index",e.C().length),a.attr("data-index",e.C().length),e.P(a),$.each(t,function(e,t){var n=$.create("li"),d=['<a href="javascript:">',t.name,"</a>"];n.P(d.join("")),0===e&&n.A("selected"),n.data("code",t.code),n.data("index",e),n.data("data",t.data),a.P(n)}),t[0].data&&t[0].data.length&&n(e,t[0].data)}var d=$.create("div","select-data"),s=t,i=this.options;if(e.P(d),s.length){var l=$.create("div","select-wrap clear"),r=[];s[0].data?(r=$.create("ul","select-tabs"),l.P(r)):l.A("single"),e.P(l);var o=s[0];a(d,r,o),r.length&&r.C().eq(0).A("active");var c=$.create("div","select-content clear");l.P(c),n(c,t),c.C().eq(0).show()}d.P('<i class="triangle"></i>')}function _request(selector){var dtd=$.Deferred(),_self=this,options=_self.options;return $.get(options.url).done(function(data){"string"==typeof data&&(data=eval("("+data+")")),void 0==data.flag||"true"!=data.flag&&data.flag!==!0?console.log("Request error:please check the network and make sure the url is correct."):(options.data=data.data,_init.call(_self,selector,options.data)),dtd.resolve()}),dtd.promise()}function _bindEvents(e){function t(){var e=$("."+c+"."+_sClass),t=$(this).parent();t.hasClass(c)?t.R(c):(e.length&&e.R(c),t.A(c))}function a(){f.find("li.active").R("active");var e=$(this).data("index"),t=$(this).parent().next().find("ul");$(this).toggleClass("active"),t.hide(),t.eq(e).show()}function n(){var e=$(this).parent(),t=e.data("index"),a=$(this).data("code");e.C().R("selected"),$(this).A("selected"),l(t,a);var n=r.options.onSelect($(this).data("index"),a);if(1==f.length)h.eq(0).find("span").text($(this).text());else{var d=e.parent().prev().C().eq(t);if(d.find("span").text($(this).text()),d.next().length){var s=!0,o=$(this).data("data"),c=d.next();i(e.next(),o),n?s=!1:c.mousedown()}if(!s){var v=$.trim(f.eq(0).text()).split(" ");$.each(h.eq(0).find("span"),function(e,t){$(t).text(v[e])})}}(!e.next().length||n)&&(h.mousedown(),r.options.onClose(r.selectedCodes))}function s(t){var a=t.srcElement||t.target;e.hasClass(c)&&!$(a).closest(h[0]).length&&e.R(c)}function i(e,t){var a=e.children();if(a.removeClass("selected"),$.each(t,function(t,d){var s=a.eq(t);if(s.length)s.children().text(d.name);else{s=$("<li></li>");var i=$('<a href="javascript:""></a>');s.data("index",a.length),i.text(d.name),s.append(i),e.append(s),_eventHandler(s,o,n)}0==t&&s.addClass("selected"),s.data("code",d.code),s.data("data",d.data)}),t.length<a.length)for(var d=a.length-1;d>=t.length;d--)a[d].remove();if(t&&t.length){var s=e.data("index"),r=e.parent().prev().C().eq(s);l(s,t[0].code),r.find("span").text(t[0].name)}if(e.next().length&&t[0].data){var c=t[0].data;i(e.next(),c)}}function l(e,t){var a=r.selectedCodes.length;if(a>e)r.selectedCodes[e]=t;else{if(e>a)for(var n=e;n>a;n--)r.selectedCodes.push(null);r.selectedCodes.push(t)}}var r=this,o="mousedown",c="expand",h=e.C();_eventHandler(h.eq(0),o,t);var f=h.eq(1).C(),v=f.eq(0).find("li");1==f.length&&(a=n),_eventHandler(v,o,a);var u=f.eq(1).find("li");_eventHandler(u,o,n),_eventHandler(h.eq(1),o,function(e){e.stopPropagation()}),_eventHandler($(d),o,s)}function _eventHandler(e,t,a){e.on(t,a)}var defaults={split:"/",url:"",data:[],hasWhole:!0,onLoad:function(){},onSelect:function(){},onClose:function(){}},areaSelect=function(e,t){return this.init.call(this,e,t),this},_sClass="area-select",d=document,jq=$.fn;jq.extend({A:jq.addClass,C:jq.children,R:jq.removeClass,P:jq.append}),areaSelect.prototype={constructor:areaSelect,init:function(e,t){var a=this,n=a.options=$.extend({},defaults,t);return a.selector=e,a.selectedCodes=[],n.data.length?(_init.call(a,e,n.data),_bindEvents.call(a,e),n.onLoad()):""!==$.trim(n.url)?$.when(_request.call(a,e)).done(function(){_bindEvents.call(a,e),n.onLoad()}):console.log("Data error: there is no data here."),a},getSelectedCodes:function(){return this.selectedCodes}},$.fn.areaSelect=function(){var e=this,t=Array.prototype.slice.call(arguments);return e.A(_sClass),e.parent().css("position","relative"),new areaSelect(e,t[0])},$.create=function(e,t){return $(d.createElement(e)).A(t)}}(jQuery,window);